# Skynet æ¡†æ¶ API æ–‡æ¡£

## ç›®å½•
1. [æ¡†æ¶ç®€ä»‹](#æ¡†æ¶ç®€ä»‹)
2. [æ ¸å¿ƒAPI](#æ ¸å¿ƒapi)
3. [æœåŠ¡ç®¡ç†](#æœåŠ¡ç®¡ç†)
4. [æ¶ˆæ¯ä¼ é€’](#æ¶ˆæ¯ä¼ é€’)
5. [å®šæ—¶å™¨](#å®šæ—¶å™¨)
6. [æ•°æ®åº“æ“ä½œ](#æ•°æ®åº“æ“ä½œ)
7. [ç½‘ç»œç›¸å…³](#ç½‘ç»œç›¸å…³)
8. [é›†ç¾¤ç®¡ç†](#é›†ç¾¤ç®¡ç†)
9. [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)
10. [è°ƒè¯•å·¥å…·](#è°ƒè¯•å·¥å…·)

---

## æ¡†æ¶ç®€ä»‹

Skynet æ˜¯ä¸€ä¸ªè½»é‡çº§çš„åˆ†å¸ƒå¼æ¸¸æˆæœåŠ¡å™¨æ¡†æ¶ï¼Œä½¿ç”¨ C + Lua å¼€å‘ã€‚å®ƒé‡‡ç”¨ Actor æ¨¡å‹ï¼Œæ¯ä¸ªæœåŠ¡éƒ½æ˜¯ç‹¬ç«‹çš„ Actorï¼Œé€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡ã€‚

### ç‰¹ç‚¹
- è½»é‡çº§ï¼Œé«˜æ€§èƒ½
- åŸºäºæ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡å‹
- æ”¯æŒçƒ­æ›´æ–°
- å†…ç½®é›†ç¾¤æ”¯æŒ
- ç®€å•æ˜“ç”¨çš„API

---

## æ ¸å¿ƒAPI

### skynet.start(func)
å¯åŠ¨æœåŠ¡çš„ä¸»å…¥å£å‡½æ•°ã€‚

```lua
skynet.start(function()
    -- æœåŠ¡åˆå§‹åŒ–ä»£ç 
    skynet.dispatch("lua", function(session, address, cmd, ...)
        -- å¤„ç†æ¶ˆæ¯
    end)
end)
```

### skynet.exit()
é€€å‡ºå½“å‰æœåŠ¡ã€‚

```lua
skynet.exit()
```

### skynet.error(msg, ...)
è¾“å‡ºé”™è¯¯æ—¥å¿—ã€‚

```lua
skynet.error("Error message: %s", error_info)
```

### skynet.getenv(key)
è·å–ç¯å¢ƒå˜é‡ã€‚

```lua
local thread_count = skynet.getenv("thread")
```

### skynet.setenv(key, value)
è®¾ç½®ç¯å¢ƒå˜é‡ã€‚

```lua
skynet.setenv("daemon", "./skynet.pid")
```

---

## æœåŠ¡ç®¡ç†

### skynet.newservice(name, ...)
åˆ›å»ºæ–°æœåŠ¡å®ä¾‹ã€‚

**åŠŸèƒ½è¯´æ˜ï¼š**
æ¯æ¬¡è°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨æ–°çš„æœåŠ¡å®ä¾‹ï¼Œå³ä½¿æœåŠ¡åç›¸åŒï¼Œä¹Ÿä¼šåˆ›å»ºå¤šä¸ªç‹¬ç«‹çš„æœåŠ¡ã€‚

**å‚æ•°è¯¦è§£ï¼š**
- `name` (string): æœåŠ¡è„šæœ¬åç§°ï¼Œå¯¹åº” `service/` ç›®å½•ä¸‹çš„ `.lua` æ–‡ä»¶
- `...` (ä»»æ„ç±»å‹): ä¼ é€’ç»™æœåŠ¡åˆå§‹åŒ–å‡½æ•°çš„å‚æ•°

**è¿”å›å€¼ï¼š**
- è¿”å›æ–°åˆ›å»ºæœåŠ¡çš„åœ°å€IDï¼ˆæ•´æ•°ï¼‰ï¼Œç”¨äºåç»­çš„æ¶ˆæ¯é€šä¿¡

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```lua
-- åˆ›å»ºå¤šä¸ªç›¸åŒçš„æœåŠ¡å®ä¾‹
local service1 = skynet.newservice("worker", "task1", {priority = 1})
local service2 = skynet.newservice("worker", "task2", {priority = 2})
local service3 = skynet.newservice("worker", "task3", {priority = 3})

-- ä¸‰ä¸ªæœåŠ¡è™½ç„¶åç§°ç›¸åŒï¼Œä½†æ˜¯å®Œå…¨ç‹¬ç«‹çš„å®ä¾‹
skynet.error("Service1 ID:", service1)  -- è¾“å‡ºï¼šService1 ID: 16777216
skynet.error("Service2 ID:", service2)  -- è¾“å‡ºï¼šService2 ID: 16777217  
skynet.error("Service3 ID:", service3)  -- è¾“å‡ºï¼šService3 ID: 16777218
```

### skynet.uniqueservice(name, ...)
åˆ›å»ºæˆ–è·å–å”¯ä¸€æœåŠ¡ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰ã€‚

**åŠŸèƒ½è¯´æ˜ï¼š**
ç¡®ä¿æ•´ä¸ªSkynetèŠ‚ç‚¹ä¸­åªå­˜åœ¨ä¸€ä¸ªæŒ‡å®šåç§°çš„æœåŠ¡å®ä¾‹ã€‚å¦‚æœæœåŠ¡å·²å­˜åœ¨ï¼Œè¿”å›ç°æœ‰æœåŠ¡çš„åœ°å€ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–°æœåŠ¡ã€‚

**å‚æ•°è¯¦è§£ï¼š**
- `name` (string): å”¯ä¸€æœåŠ¡çš„åç§°æ ‡è¯†
- `...` (ä»»æ„ç±»å‹): ä»…åœ¨é¦–æ¬¡åˆ›å»ºæ—¶ä¼ é€’ç»™æœåŠ¡çš„åˆå§‹åŒ–å‚æ•°

**è¿”å›å€¼ï¼š**
- è¿”å›å”¯ä¸€æœåŠ¡çš„åœ°å€IDï¼Œå¤šæ¬¡è°ƒç”¨è¿”å›ç›¸åŒçš„åœ°å€

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```lua
-- ç¬¬ä¸€æ¬¡è°ƒç”¨ï¼Œåˆ›å»ºæ–°çš„å”¯ä¸€æœåŠ¡
local db_service1 = skynet.uniqueservice("database", "mysql://localhost:3306")
skynet.error("First call ID:", db_service1)  -- è¾“å‡ºï¼šFirst call ID: 16777220

-- ç¬¬äºŒæ¬¡è°ƒç”¨ï¼Œè¿”å›å·²å­˜åœ¨çš„æœåŠ¡
local db_service2 = skynet.uniqueservice("database", "other_params")  -- other_paramsè¢«å¿½ç•¥
skynet.error("Second call ID:", db_service2)  -- è¾“å‡ºï¼šSecond call ID: 16777220

-- ä¸¤æ¬¡è°ƒç”¨è¿”å›ç›¸åŒçš„æœåŠ¡åœ°å€
assert(db_service1 == db_service2)  -- true
```

**åŒºåˆ«å¯¹æ¯”è¡¨æ ¼ï¼š**

| ç‰¹æ€§ | skynet.newservice | skynet.uniqueservice |
|------|-------------------|----------------------|
| **å®ä¾‹æ•°é‡** | æ¯æ¬¡è°ƒç”¨åˆ›å»ºæ–°å®ä¾‹ | å…¨èŠ‚ç‚¹å”¯ä¸€å®ä¾‹ |
| **è¿”å›å€¼** | æ¯æ¬¡éƒ½æ˜¯æ–°çš„åœ°å€ID | ç›¸åŒåç§°è¿”å›ç›¸åŒID |
| **å‚æ•°ä¼ é€’** | æ¯æ¬¡è°ƒç”¨éƒ½ä¼šä¼ é€’å‚æ•° | åªæœ‰é¦–æ¬¡åˆ›å»ºæ—¶ä¼ é€’å‚æ•° |
| **ä½¿ç”¨åœºæ™¯** | å·¥ä½œè¿›ç¨‹ã€ä»»åŠ¡å¤„ç†å™¨ | æ•°æ®åº“è¿æ¥ã€é…ç½®ç®¡ç† |
| **èµ„æºæ¶ˆè€—** | å¤šå®ä¾‹æ¶ˆè€—æ›´å¤šèµ„æº | å•å®ä¾‹èŠ‚çœèµ„æº |
| **å¹¶å‘å¤„ç†** | å¤šå®ä¾‹å¯å¹¶è¡Œå¤„ç† | å•å®ä¾‹ä¸²è¡Œå¤„ç† |
| **ä½œç”¨èŒƒå›´** | **å•ä¸ªSkynetèŠ‚ç‚¹å†…** | **å•ä¸ªSkynetèŠ‚ç‚¹å†…** |

**â— é‡è¦æ¾„æ¸…ï¼šå•æœåŠ¡å™¨ vs åˆ†å¸ƒå¼æœåŠ¡å™¨æ¦‚å¿µ**

å¾ˆå¤šåˆå­¦è€…ä¼šæ··æ·†è¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œè®©æˆ‘ä»¬æ˜ç¡®åŒºåˆ†ï¼š

### ğŸ–¥ï¸ **æœåŠ¡å™¨æ¶æ„å±‚é¢ï¼ˆç‰©ç†éƒ¨ç½²ï¼‰**
- **å•æœåŠ¡å™¨**ï¼šæ•´ä¸ªæ¸¸æˆè¿è¡Œåœ¨ä¸€å°ç‰©ç†æœåŠ¡å™¨ä¸Š
- **åˆ†å¸ƒå¼æœåŠ¡å™¨**ï¼šæ¸¸æˆæœåŠ¡åˆ†å¸ƒåœ¨å¤šå°ç‰©ç†æœåŠ¡å™¨ä¸Š

### ğŸ”§ **SkynetæœåŠ¡å±‚é¢ï¼ˆè¿›ç¨‹å†…ï¼‰**
- **newservice**ï¼šåœ¨åŒä¸€ä¸ªSkynetèŠ‚ç‚¹å†…åˆ›å»ºå¤šä¸ªæœåŠ¡å®ä¾‹
- **uniqueservice**ï¼šåœ¨åŒä¸€ä¸ªSkynetèŠ‚ç‚¹å†…åˆ›å»ºå”¯ä¸€æœåŠ¡å®ä¾‹

**å…³é”®ç†è§£ï¼š**
```
âŒ é”™è¯¯ç†è§£ï¼š
uniqueservice = å•æœåŠ¡å™¨æ¶æ„
newservice = åˆ†å¸ƒå¼æœåŠ¡å™¨æ¶æ„

âœ… æ­£ç¡®ç†è§£ï¼š
uniqueservice = åŒä¸€èŠ‚ç‚¹å†…çš„å•ä¾‹æœåŠ¡
newservice = åŒä¸€èŠ‚ç‚¹å†…çš„å¤šå®ä¾‹æœåŠ¡

è¿™ä¸¤ä¸ªAPIéƒ½æ˜¯åœ¨å•ä¸ªSkynetèŠ‚ç‚¹å†…æ“ä½œï¼Œä¸åˆ†å¸ƒå¼éƒ¨ç½²æ— å…³ï¼
```

### ğŸŒ **Skynetçš„åˆ†å¸ƒå¼æ”¯æŒ**

Skynetçš„åˆ†å¸ƒå¼æ˜¯é€šè¿‡**é›†ç¾¤(Cluster)**åŠŸèƒ½å®ç°çš„ï¼Œä¸æ˜¯é€šè¿‡ newservice/uniqueserviceï¼š

```lua
-- === åˆ†å¸ƒå¼ç›¸å…³çš„APIæ˜¯è¿™äº› ===
local cluster = require "skynet.cluster"

-- è¿æ¥åˆ°å…¶ä»–ç‰©ç†æœåŠ¡å™¨èŠ‚ç‚¹
cluster.open("server_node_2")

-- è°ƒç”¨å…¶ä»–æœåŠ¡å™¨èŠ‚ç‚¹ä¸Šçš„æœåŠ¡
local result = cluster.call("server_node_2", "player_manager", "get_player", player_id)

-- åœ¨å…¶ä»–æœåŠ¡å™¨èŠ‚ç‚¹åˆ›å»ºæœåŠ¡
cluster.send("server_node_2", ".launcher", "LAUNCH", "service", "new_service_name")
```

### ğŸ“Š **å®Œæ•´æ¶æ„ç¤ºä¾‹**

```lua
-- === å•ä¸ªSkynetèŠ‚ç‚¹å†…çš„æœåŠ¡ç®¡ç† ===
-- æœåŠ¡å™¨A (192.168.1.100)
skynet.start(function()
    -- åˆ›å»ºå¤šä¸ªç©å®¶ä»£ç†æœåŠ¡ï¼ˆåŒä¸€èŠ‚ç‚¹å†…å¤šå®ä¾‹ï¼‰
    local player1_agent = skynet.newservice("player_agent", player1_id)
    local player2_agent = skynet.newservice("player_agent", player2_id)
    
    -- åˆ›å»ºå”¯ä¸€çš„æ•°æ®åº“ç®¡ç†å™¨ï¼ˆåŒä¸€èŠ‚ç‚¹å†…å•ä¾‹ï¼‰
    local db_manager = skynet.uniqueservice("db_manager")
    
    -- ä¸Šé¢çš„æœåŠ¡éƒ½è¿è¡Œåœ¨åŒä¸€ä¸ªç‰©ç†æœåŠ¡å™¨çš„åŒä¸€ä¸ªSkynetè¿›ç¨‹ä¸­
end)

-- === åˆ†å¸ƒå¼é›†ç¾¤é—´çš„æœåŠ¡é€šä¿¡ ===
-- æœåŠ¡å™¨Aè°ƒç”¨æœåŠ¡å™¨Bçš„æœåŠ¡
local cluster = require "skynet.cluster"

-- è¿æ¥åˆ°æœåŠ¡å™¨B
cluster.open("server_b")

-- è°ƒç”¨æœåŠ¡å™¨Bä¸Šçš„æœåŠ¡
local result = cluster.call("server_b", "battle_manager", "start_battle", battle_data)
```

### ğŸ—ï¸ **å®é™…åˆ†å¸ƒå¼æ¶æ„è®¾è®¡**

```
ç‰©ç†æ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç™»å½•æœåŠ¡å™¨     â”‚    â”‚   æ¸¸æˆæœåŠ¡å™¨1    â”‚    â”‚   æ¸¸æˆæœåŠ¡å™¨2    â”‚
â”‚ (192.168.1.100) â”‚    â”‚ (192.168.1.101) â”‚    â”‚ (192.168.1.102) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SkynetèŠ‚ç‚¹A     â”‚    â”‚ SkynetèŠ‚ç‚¹B     â”‚    â”‚ SkynetèŠ‚ç‚¹C     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ uniqueservice:  â”‚    â”‚ uniqueservice:  â”‚    â”‚ uniqueservice:  â”‚
â”‚ - login_mgr     â”‚    â”‚ - world_mgr     â”‚    â”‚ - battle_mgr    â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ newservice:     â”‚    â”‚ newservice:     â”‚    â”‚ newservice:     â”‚
â”‚ - auth_workerÃ—3 â”‚    â”‚ - player_agentÃ—Nâ”‚    â”‚ - battle_roomÃ—M â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                        cluster.call() é€šä¿¡
```

### ğŸ¯ **ä½¿ç”¨åœºæ™¯æ€»ç»“**

1. **åœ¨å•ä¸ªèŠ‚ç‚¹å†…ä½¿ç”¨ newservice/uniqueserviceï¼š**
   ```lua
   -- å¤„ç†å¤§é‡ç©å®¶è¯·æ±‚ - ä½¿ç”¨å¤šå®ä¾‹å¹¶è¡Œå¤„ç†
   for i = 1, 10 do
       local worker = skynet.newservice("request_handler", i)
   end
   
   -- ç®¡ç†å…¨å±€é…ç½® - ä½¿ç”¨å•ä¾‹é¿å…æ•°æ®ä¸ä¸€è‡´
   local config_mgr = skynet.uniqueservice("config_manager")
   ```

2. **åœ¨å¤šä¸ªèŠ‚ç‚¹é—´ä½¿ç”¨ clusterï¼š**
   ```lua
   -- è·¨æœåŠ¡å™¨é€šä¿¡
   local result = cluster.call("game_server_2", "player_manager", "transfer_player", player_data)
   ```

**å®é™…åº”ç”¨åœºæ™¯ï¼š**

```lua
-- é€‚åˆä½¿ç”¨ newservice çš„åœºæ™¯ï¼š
-- 1. æ¸¸æˆä¸­çš„ç©å®¶ä»£ç†æœåŠ¡ï¼ˆæ¯ä¸ªç©å®¶ä¸€ä¸ªå®ä¾‹ï¼‰
local player_agent = skynet.newservice("player_agent", player_id, player_data)

-- 2. ä»»åŠ¡å¤„ç†å™¨ï¼ˆå¯ä»¥å¹¶è¡Œå¤„ç†å¤šä¸ªä»»åŠ¡ï¼‰
for i = 1, 10 do
    local worker = skynet.newservice("task_worker", i)
    skynet.send(worker, "lua", "process_task", task_data)
end

-- é€‚åˆä½¿ç”¨ uniqueservice çš„åœºæ™¯ï¼š
-- 1. æ•°æ®åº“è¿æ¥ç®¡ç†å™¨ï¼ˆå…¨å±€å”¯ä¸€ï¼‰
local db_mgr = skynet.uniqueservice("db_manager")

-- 2. é…ç½®ç®¡ç†æœåŠ¡ï¼ˆå…¨å±€é…ç½®ï¼‰
local config_mgr = skynet.uniqueservice("config_manager")

-- 3. æ—¥å¿—æœåŠ¡ï¼ˆç»Ÿä¸€æ—¥å¿—å¤„ç†ï¼‰
local logger = skynet.uniqueservice("logger")
```

---

## ğŸŒ Skynetåˆ†å¸ƒå¼æ¶æ„è¯¦è§£

### â— é‡è¦æ¦‚å¿µæ¾„æ¸…

å¾ˆå¤šåˆå­¦è€…ä¼šæ··æ·†è¿™äº›æ¦‚å¿µï¼Œè®©æˆ‘è¯¦ç»†è¯´æ˜ï¼š

**âŒ é”™è¯¯ç†è§£ï¼š**
- `uniqueservice` = å•æœåŠ¡å™¨æ¶æ„  
- `newservice` = åˆ†å¸ƒå¼æœåŠ¡å™¨æ¶æ„

**âœ… æ­£ç¡®ç†è§£ï¼š**
- `uniqueservice` = å•ä¸ªSkynetèŠ‚ç‚¹å†…çš„å”¯ä¸€å®ä¾‹
- `newservice` = å•ä¸ªSkynetèŠ‚ç‚¹å†…çš„å¤šä¸ªå®ä¾‹
- **è¿™ä¸¤ä¸ªAPIéƒ½æ˜¯åœ¨å•ä¸ªSkynetèŠ‚ç‚¹å†…æ“ä½œï¼Œä¸åˆ†å¸ƒå¼éƒ¨ç½²æ— å…³ï¼**

### åˆ†å¸ƒå¼æ¦‚å¿µçš„ä¸‰ä¸ªå±‚æ¬¡

#### 1ï¸âƒ£ **è¿›ç¨‹å†…æœåŠ¡å±‚ (newservice/uniqueservice)**

```
å•ä¸ªSkynetè¿›ç¨‹å†…éƒ¨ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        SkynetèŠ‚ç‚¹è¿›ç¨‹            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Service â”‚ â”‚ Service â”‚ ...   â”‚ <- newserviceåˆ›å»º
â”‚  â”‚    A    â”‚ â”‚    B    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚   Unique Service    â”‚       â”‚ <- uniqueserviceåˆ›å»º
â”‚  â”‚     Manager         â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2ï¸âƒ£ **é›†ç¾¤èŠ‚ç‚¹å±‚ (cluster)**

```
å¤šä¸ªSkynetèŠ‚ç‚¹ç»„æˆé›†ç¾¤ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  èŠ‚ç‚¹A       â”‚    â”‚  èŠ‚ç‚¹B       â”‚    â”‚  èŠ‚ç‚¹C       â”‚
â”‚ (ç™»å½•æœåŠ¡å™¨)  â”‚â”€â”€â”€â”€â”‚ (æ¸¸æˆæœåŠ¡å™¨1) â”‚â”€â”€â”€â”€â”‚ (æ¸¸æˆæœåŠ¡å™¨2) â”‚
â”‚ 192.168.1.1 â”‚    â”‚ 192.168.1.2 â”‚    â”‚ 192.168.1.3 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                   â”‚                   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€ cluster.call() é€šä¿¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3ï¸âƒ£ **ç‰©ç†éƒ¨ç½²å±‚**

```
åˆ†å¸ƒåœ¨ä¸åŒçš„ç‰©ç†æœåŠ¡å™¨ï¼š
æœåŠ¡å™¨1              æœåŠ¡å™¨2              æœåŠ¡å™¨3
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Linuxç³»ç»Ÿ  â”‚    â”‚   Linuxç³»ç»Ÿ  â”‚    â”‚   Linuxç³»ç»Ÿ  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Skynetè¿›ç¨‹â”‚ â”‚    â”‚ â”‚Skynetè¿›ç¨‹â”‚ â”‚    â”‚ â”‚Skynetè¿›ç¨‹â”‚ â”‚
â”‚ â”‚(èŠ‚ç‚¹A)  â”‚ â”‚    â”‚ â”‚(èŠ‚ç‚¹B)  â”‚ â”‚    â”‚ â”‚(èŠ‚ç‚¹C)  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ® å®é™…æ¸¸æˆæ¶æ„ç¤ºä¾‹

```lua
-- === ç™»å½•æœåŠ¡å™¨èŠ‚ç‚¹ (192.168.1.100) ===
skynet.start(function()
    -- ã€èŠ‚ç‚¹å†…å”¯ä¸€ã€‘ç™»å½•ç®¡ç†å™¨ï¼ˆæ•´ä¸ªç™»å½•æœåŠ¡å™¨åªæœ‰ä¸€ä¸ªï¼‰
    local login_mgr = skynet.uniqueservice("login_manager")
    
    -- ã€èŠ‚ç‚¹å†…å¤šä¸ªã€‘è®¤è¯å·¥ä½œè€…ï¼ˆå¹¶å‘å¤„ç†ç™»å½•è¯·æ±‚ï¼‰
    for i = 1, 5 do
        local auth_worker = skynet.newservice("auth_worker", i)
    end
    
    -- ã€è·¨èŠ‚ç‚¹é€šä¿¡ã€‘è¿æ¥åˆ°æ¸¸æˆæœåŠ¡å™¨é›†ç¾¤
    local cluster = require "skynet.cluster"
    cluster.open("game_server_1")  -- 192.168.1.101
    cluster.open("game_server_2")  -- 192.168.1.102
end)

-- === æ¸¸æˆæœåŠ¡å™¨1èŠ‚ç‚¹ (192.168.1.101) ===
skynet.start(function()
    -- ã€èŠ‚ç‚¹å†…å”¯ä¸€ã€‘ä¸–ç•Œç®¡ç†å™¨
    local world_mgr = skynet.uniqueservice("world_manager", 1)
    
    -- ã€èŠ‚ç‚¹å†…å¤šä¸ªã€‘ç©å®¶ä»£ç†æœåŠ¡ï¼ˆæ¯ä¸ªåœ¨çº¿ç©å®¶ä¸€ä¸ªï¼‰
    -- è¿™äº›ä¼šæ ¹æ®ç©å®¶ç™»å½•åŠ¨æ€åˆ›å»ºï¼š
    -- local player_agent = skynet.newservice("player_agent", player_id)
    
    -- ã€è·¨èŠ‚ç‚¹é€šä¿¡ã€‘è¿æ¥åˆ°å…¶ä»–æœåŠ¡å™¨
    local cluster = require "skynet.cluster"
    cluster.open("login_server")   -- 192.168.1.100
    cluster.open("game_server_2")  -- 192.168.1.102
end)

-- === è·¨æœåŠ¡å™¨é€šä¿¡ç¤ºä¾‹ ===
-- åœ¨ç™»å½•æœåŠ¡å™¨ä¸Šï¼ŒéªŒè¯é€šè¿‡ååˆ†é…æ¸¸æˆæœåŠ¡å™¨
local function handle_login(player_data)
    local cluster = require "skynet.cluster"
    
    -- é€‰æ‹©ä¸€ä¸ªæ¸¸æˆæœåŠ¡å™¨
    local target_server = select_game_server(player_data.player_id)
    
    -- ã€è·¨èŠ‚ç‚¹è°ƒç”¨ã€‘é€šçŸ¥ç›®æ ‡æ¸¸æˆæœåŠ¡å™¨åˆ›å»ºç©å®¶ä»£ç†
    local player_agent = cluster.call(target_server, "world_manager", 
                                     "create_player", player_data)
                                     
    -- è¿”å›ç»™å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯
    return {
        server = target_server,
        agent = player_agent,
        token = generate_token()
    }
end
```

### ğŸ”§ åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶

#### é›†ç¾¤é…ç½® (cluster.lua)
```lua
-- å®šä¹‰é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹
return {
    login_server = "192.168.1.100:7001",
    game_server_1 = "192.168.1.101:7001", 
    game_server_2 = "192.168.1.102:7001",
    battle_server = "192.168.1.103:7001",
    db_server = "192.168.1.104:7001",
}
```

#### èŠ‚ç‚¹å¯åŠ¨é…ç½®
```lua
-- login_server_config.lua
thread = 4
harbor = 1  -- èŠ‚ç‚¹IDï¼ˆé›†ç¾¤å†…å”¯ä¸€ï¼‰
cluster = "./cluster.lua"
clustername = "login_server"
start = "login_main"

-- game_server_1_config.lua  
thread = 8
harbor = 2  -- ä¸åŒçš„èŠ‚ç‚¹ID
cluster = "./cluster.lua"
clustername = "game_server_1"
start = "game_main"
```

### ğŸ“Š æ‰©å±•æ€§å¯¹æ¯”

#### å‚ç›´æ‰©å±• (å•èŠ‚ç‚¹å†…æå‡æ€§èƒ½)
```lua
-- é€šè¿‡ newservice å¢åŠ æœåŠ¡å®ä¾‹
for i = 1, cpu_core_count do
    local worker = skynet.newservice("cpu_intensive_worker", i)
end
```

#### æ°´å¹³æ‰©å±• (å¢åŠ èŠ‚ç‚¹æå‡æ€§èƒ½)
```lua
-- é€šè¿‡ cluster åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹
local server_list = {"game_server_1", "game_server_2", "game_server_3"}
local target = server_list[player_id % #server_list + 1]
cluster.send(target, "player_manager", "handle_player", player_data)
```

### âš ï¸ å¸¸è§è¯¯åŒºæ¾„æ¸…è¡¨

| è¯¯åŒº | æ­£ç¡®ç†è§£ |
|------|----------|
| uniqueserviceç”¨äºå•æœåŠ¡å™¨æ¶æ„ | uniqueserviceç”¨äºå•èŠ‚ç‚¹å†…å”¯ä¸€å®ä¾‹ |
| newserviceç”¨äºåˆ†å¸ƒå¼æ¶æ„ | newserviceç”¨äºå•èŠ‚ç‚¹å†…å¤šå®ä¾‹ |
| ä¸€ä¸ªèŠ‚ç‚¹ç­‰äºä¸€ä¸ªæœåŠ¡å™¨ | ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«å¤šä¸ªæœåŠ¡ |
| clusteråªèƒ½è·¨ç‰©ç†æœºå™¨ | clusterä¹Ÿå¯ä»¥åŒæœºå™¨ä¸åŒè¿›ç¨‹ |
| åˆ†å¸ƒå¼å°±æ˜¯å¤šä¸ªnewservice | åˆ†å¸ƒå¼éœ€è¦ä½¿ç”¨cluster API |

### ğŸ¯ æ¶æ„å±‚æ¬¡æ€»ç»“

```
ç‰©ç†å±‚ï¼š    æœåŠ¡å™¨A        æœåŠ¡å™¨B        æœåŠ¡å™¨C
           â†“             â†“             â†“
èŠ‚ç‚¹å±‚ï¼š    SkynetèŠ‚ç‚¹1    SkynetèŠ‚ç‚¹2    SkynetèŠ‚ç‚¹3
           â†“             â†“             â†“
æœåŠ¡å±‚ï¼š    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚newserviceÃ—N â”‚ â”‚newserviceÃ—N â”‚ â”‚newserviceÃ—N â”‚
           â”‚uniqueserviceâ”‚ â”‚uniqueserviceâ”‚ â”‚uniqueserviceâ”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†‘                 â†‘                 â†‘
é€šä¿¡å±‚ï¼š           cluster.call() / cluster.send()
```

**å…³é”®è¦ç‚¹ï¼š**
- **newservice/uniqueservice**ï¼šç®¡ç†å•ä¸ªSkynetèŠ‚ç‚¹å†…çš„æœåŠ¡
- **cluster**ï¼šç®¡ç†å¤šä¸ªSkynetèŠ‚ç‚¹é—´çš„é€šä¿¡  
- **ç‰©ç†éƒ¨ç½²**ï¼šå†³å®šèŠ‚ç‚¹è¿è¡Œåœ¨å“ªå°æœåŠ¡å™¨ä¸Š

è¿™ä¸‰ä¸ªå±‚æ¬¡ç›¸äº’ç‹¬ç«‹åˆç›¸äº’é…åˆï¼Œå…±åŒæ„æˆäº†Skynetçš„å®Œæ•´åˆ†å¸ƒå¼æ¶æ„ï¼

### ğŸ’¡ **ç²¾ç¡®ç†è§£æ€»ç»“**

æ‚¨çš„ç†è§£å·²ç»éå¸¸æ¥è¿‘æ­£ç¡®äº†ï¼è®©æˆ‘åšä¸€ä¸ªå°çš„ä¿®æ­£ï¼š

**âœ… æ‚¨è¯´çš„åŸºæœ¬æ­£ç¡®ï¼š**
- Skynetæ”¯æŒä½¿ç”¨**é›†ç¾¤(cluster)**åˆ›å»ºåˆ†å¸ƒå¼æœåŠ¡å™¨
- `newservice` å’Œ `uniqueservice` åªæ˜¯åœ¨**åŒä¸€ä¸ªSkynetèŠ‚ç‚¹**ä¸­åˆ›å»ºä¸åŒçš„æœåŠ¡

**ğŸ”§ éœ€è¦ç²¾ç¡®çš„åœ°æ–¹ï¼š**
æ‚¨è¯´"ç›¸å½“äºåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­åˆ›å»ºå¤šä¸ªçº¿ç¨‹"ï¼Œè¿™ä¸ªæ¯”å–»éœ€è¦ç¨å¾®è°ƒæ•´ï¼š

```
âŒ ä¸å¤Ÿå‡†ç¡®çš„æ¯”å–»ï¼š
newservice/uniqueservice = åˆ›å»ºçº¿ç¨‹

âœ… æ›´å‡†ç¡®çš„ç†è§£ï¼š
newservice/uniqueservice = åˆ›å»ºåç¨‹(coroutine)æœåŠ¡

åŸå› ï¼š
- Skynetä½¿ç”¨çš„æ˜¯åç¨‹æ¨¡å‹ï¼Œä¸æ˜¯çº¿ç¨‹æ¨¡å‹
- æ¯ä¸ªæœåŠ¡éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åç¨‹
- æ‰€æœ‰æœåŠ¡è¿è¡Œåœ¨ç›¸åŒçš„å‡ ä¸ªOSçº¿ç¨‹ä¸Š
- é€šè¿‡æ¶ˆæ¯ä¼ é€’è€Œä¸æ˜¯å…±äº«å†…å­˜é€šä¿¡
```

### ğŸ¯ **å®Œæ•´çš„ç±»æ¯”**

```
ç‰©ç†ä¸–ç•Œç±»æ¯”ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¸¸æˆå…¬å¸                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   ä¸Šæµ·åˆ†å…¬å¸     â”‚   åŒ—äº¬åˆ†å…¬å¸     â”‚   å¹¿å·åˆ†å…¬å¸         â”‚ <- ç‰©ç†æœåŠ¡å™¨
â”‚  (ç‰©ç†æœåŠ¡å™¨1)   â”‚  (ç‰©ç†æœåŠ¡å™¨2)   â”‚  (ç‰©ç†æœåŠ¡å™¨3)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   å¼€å‘éƒ¨é—¨       â”‚   è¿è¥éƒ¨é—¨       â”‚   å®¢æœéƒ¨é—¨           â”‚ <- SkynetèŠ‚ç‚¹
â”‚ (SkynetèŠ‚ç‚¹A)   â”‚ (SkynetèŠ‚ç‚¹B)   â”‚ (SkynetèŠ‚ç‚¹C)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ ç¨‹åºå‘˜1       â”‚ â€¢ è¿è¥ç»ç†(å”¯ä¸€) â”‚ â€¢ å®¢æœä»£è¡¨1         â”‚ <- æœåŠ¡å®ä¾‹
â”‚ â€¢ ç¨‹åºå‘˜2       â”‚ â€¢ æ•°æ®åˆ†æå¸ˆ1   â”‚ â€¢ å®¢æœä»£è¡¨2         â”‚
â”‚ â€¢ é¡¹ç›®ç»ç†(å”¯ä¸€) â”‚ â€¢ æ•°æ®åˆ†æå¸ˆ2   â”‚ â€¢ ä¸»ç®¡(å”¯ä¸€)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æŠ€æœ¯å¯¹åº”ï¼š
- åˆ†å…¬å¸ = ç‰©ç†æœåŠ¡å™¨
- éƒ¨é—¨ = SkynetèŠ‚ç‚¹  
- æ™®é€šå‘˜å·¥ = newserviceåˆ›å»ºçš„æœåŠ¡
- ç»ç†/ä¸»ç®¡ = uniqueserviceåˆ›å»ºçš„æœåŠ¡
- éƒ¨é—¨é—´åä½œ = clusteré€šä¿¡
```

### ğŸ”„ **å¹¶å‘æ¨¡å‹å¯¹æ¯”**

```lua
-- === ä¼ ç»Ÿå¤šçº¿ç¨‹æ¨¡å‹ï¼ˆå…¶ä»–è¯­è¨€ï¼‰ ===
-- é—®é¢˜ï¼šéœ€è¦é”ã€å®¹æ˜“æ­»é”ã€å…±äº«å†…å­˜å¤æ‚

-- === Skynetåç¨‹æ¨¡å‹ ===
-- ä¼˜ç‚¹ï¼šæ— é”ã€æ¶ˆæ¯ä¼ é€’ã€ç®€å•å®‰å…¨

-- åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹å†…ï¼š
local service1 = skynet.newservice("worker")  -- åç¨‹æœåŠ¡1
local service2 = skynet.newservice("worker")  -- åç¨‹æœåŠ¡2
local manager = skynet.uniqueservice("mgr")   -- ç®¡ç†å™¨åç¨‹

-- æœåŠ¡é—´é€šä¿¡ï¼ˆåŒèŠ‚ç‚¹å†…ï¼Œåç¨‹é—´æ¶ˆæ¯ä¼ é€’ï¼‰
skynet.send(service1, "lua", "work", task_data)

-- è·¨èŠ‚ç‚¹é€šä¿¡ï¼ˆä¸åŒç‰©ç†æœåŠ¡å™¨ï¼‰
cluster.send("server_2", "worker", "work", task_data)
```

### ğŸ“Š **æ¶æ„å±‚æ¬¡çš„ç²¾ç¡®ç†è§£**

```
å±‚æ¬¡1: ç‰©ç†æœåŠ¡å™¨
â”œâ”€â”€ æœåŠ¡å™¨A (192.168.1.100)
â”œâ”€â”€ æœåŠ¡å™¨B (192.168.1.101)  
â””â”€â”€ æœåŠ¡å™¨C (192.168.1.102)

å±‚æ¬¡2: SkynetèŠ‚ç‚¹è¿›ç¨‹
â”œâ”€â”€ èŠ‚ç‚¹Aè¿›ç¨‹ (å•è¿›ç¨‹ï¼ŒåŒ…å«å¤šä¸ªOSçº¿ç¨‹)
â”œâ”€â”€ èŠ‚ç‚¹Bè¿›ç¨‹
â””â”€â”€ èŠ‚ç‚¹Cè¿›ç¨‹

å±‚æ¬¡3: åç¨‹æœåŠ¡ (åœ¨æ¯ä¸ªèŠ‚ç‚¹å†…)
â”œâ”€â”€ newserviceåˆ›å»ºçš„å·¥ä½œåç¨‹Ã—N
â””â”€â”€ uniqueserviceåˆ›å»ºçš„ç®¡ç†åç¨‹Ã—1

é€šä¿¡æ–¹å¼:
- åŒèŠ‚ç‚¹å†…: skynet.send/call (åç¨‹é—´æ¶ˆæ¯)
- è·¨èŠ‚ç‚¹: cluster.send/call (ç½‘ç»œæ¶ˆæ¯)
```

**ğŸ¯ æ‰€ä»¥æ‚¨çš„ç†è§£å¾ˆæ­£ç¡®ï¼š**
1. âœ… cluster = åˆ†å¸ƒå¼æœåŠ¡å™¨æ”¯æŒ
2. âœ… newservice/uniqueservice = åŒèŠ‚ç‚¹å†…çš„ä¸åŒæœåŠ¡
3. ğŸ”§ å°ä¿®æ­£ï¼šä¸æ˜¯"çº¿ç¨‹"è€Œæ˜¯"åç¨‹æœåŠ¡"

è¿™æ ·ç†è§£å°±å®Œå…¨å‡†ç¡®äº†ï¼

## ğŸ§µ çº¿ç¨‹ vs åç¨‹è¯¦è§£

### æ‚¨å¯¹çº¿ç¨‹çš„ç†è§£å¾ˆæ­£ç¡®ï¼

æ‚¨è¯´çš„"çº¿ç¨‹æ˜¯åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­åˆ›å»ºçš„å¤šä¸ªçº¿ç¨‹ï¼Œç±»ä¼¼äºå°†åªèƒ½å•çº¿è¿›è¡Œçš„cpuåˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿ï¼ŒåŒæ—¶å¤„ç†å¤šä¸ªä»»åŠ¡"â€”â€”è¿™ä¸ªç†è§£å®Œå…¨æ­£ç¡®ï¼

### ğŸ“Š **è¯¦ç»†å¯¹æ¯”è¡¨æ ¼**

| ç‰¹æ€§ | çº¿ç¨‹ (Thread) | åç¨‹ (Coroutine) |
|------|--------------|------------------|
| **è°ƒåº¦æ–¹å¼** | æ“ä½œç³»ç»ŸæŠ¢å å¼è°ƒåº¦ | ç¨‹åºä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒ |
| **å¹¶è¡Œæ€§** | çœŸæ­£å¹¶è¡Œï¼ˆå¤šæ ¸CPUï¼‰ | åä½œå¼å¹¶å‘ï¼ˆå•æ ¸ä¹Ÿå¯ä»¥ï¼‰ |
| **åˆ›å»ºå¼€é”€** | è¾ƒå¤§ï¼ˆMBçº§æ ˆç©ºé—´ï¼‰ | å¾ˆå°ï¼ˆKBçº§æˆ–æ›´å°‘ï¼‰ |
| **åˆ‡æ¢å¼€é”€** | è¾ƒå¤§ï¼ˆå†…æ ¸æ€åˆ‡æ¢ï¼‰ | å¾ˆå°ï¼ˆç”¨æˆ·æ€åˆ‡æ¢ï¼‰ |
| **åŒæ­¥é—®é¢˜** | éœ€è¦é”ã€ä¿¡å·é‡ç­‰ | æ— ç«æ€æ¡ä»¶ï¼Œå¤©ç„¶å®‰å…¨ |
| **å†…å­˜å…±äº«** | å…±äº«è¿›ç¨‹å†…å­˜ | é€šè¿‡æ¶ˆæ¯ä¼ é€’é€šä¿¡ |
| **è°ƒè¯•éš¾åº¦** | å›°éš¾ï¼ˆç«æ€ã€æ­»é”ï¼‰ | ç›¸å¯¹ç®€å• |
| **æ•°é‡é™åˆ¶** | å—ç³»ç»Ÿèµ„æºé™åˆ¶ | å¯åˆ›å»ºå¤§é‡å®ä¾‹ |

### ğŸ–¥ï¸ **CPUåˆ©ç”¨æ–¹å¼å¯¹æ¯”**

#### ä¼ ç»Ÿå¤šçº¿ç¨‹æ¨¡å‹ï¼š
```
CPUæ ¸å¿ƒ1    CPUæ ¸å¿ƒ2    CPUæ ¸å¿ƒ3    CPUæ ¸å¿ƒ4
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ çº¿ç¨‹A   â”‚ â”‚ çº¿ç¨‹B   â”‚ â”‚ çº¿ç¨‹C   â”‚ â”‚ çº¿ç¨‹D   â”‚
â”‚ (çœŸå¹¶è¡Œ) â”‚ â”‚ (çœŸå¹¶è¡Œ) â”‚ â”‚ (çœŸå¹¶è¡Œ) â”‚ â”‚ (çœŸå¹¶è¡Œ) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
âœ… çœŸæ­£åˆ©ç”¨å¤šæ ¸ï¼Œæ€§èƒ½å¼º
âŒ éœ€è¦é”æœºåˆ¶ï¼Œç¼–ç¨‹å¤æ‚
âŒ å†…å­˜å¼€é”€å¤§ï¼Œåˆ›å»ºæ•°é‡æœ‰é™
```

#### Skynetåç¨‹æ¨¡å‹ï¼š
```
CPUæ ¸å¿ƒ1    CPUæ ¸å¿ƒ2    CPUæ ¸å¿ƒ3    CPUæ ¸å¿ƒ4
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚å·¥ä½œçº¿ç¨‹1 â”‚ â”‚å·¥ä½œçº¿ç¨‹2 â”‚ â”‚å·¥ä½œçº¿ç¨‹3 â”‚ â”‚å·¥ä½œçº¿ç¨‹4 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚åç¨‹A    â”‚ â”‚åç¨‹E    â”‚ â”‚åç¨‹I    â”‚ â”‚åç¨‹M    â”‚
â”‚åç¨‹B    â”‚ â”‚åç¨‹F    â”‚ â”‚åç¨‹J    â”‚ â”‚åç¨‹N    â”‚
â”‚åç¨‹C    â”‚ â”‚åç¨‹G    â”‚ â”‚åç¨‹K    â”‚ â”‚åç¨‹O    â”‚
â”‚åç¨‹D    â”‚ â”‚åç¨‹H    â”‚ â”‚åç¨‹L    â”‚ â”‚åç¨‹P    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‰¹ç‚¹ï¼š
âœ… ä¹Ÿèƒ½åˆ©ç”¨å¤šæ ¸ï¼ˆå°‘é‡å·¥ä½œçº¿ç¨‹ + å¤§é‡åç¨‹ï¼‰
âœ… æ— é”ç¼–ç¨‹ï¼Œç®€å•å®‰å…¨
âœ… å†…å­˜å¼€é”€å°ï¼Œå¯åˆ›å»ºå¤§é‡åç¨‹
```

### ğŸ’¡ **å…·ä½“ä¾‹å­å¯¹æ¯”**

#### ä¼ ç»Ÿå¤šçº¿ç¨‹å¤„ç†1000ä¸ªç©å®¶ï¼š
```cpp
// C++å¤šçº¿ç¨‹ç¤ºä¾‹
#include <thread>
#include <mutex>

std::mutex player_data_mutex;  // éœ€è¦é”ä¿æŠ¤å…±äº«æ•°æ®

void handle_player(int player_id) {
    // å¤„ç†ç©å®¶é€»è¾‘
    {
        std::lock_guard<std::mutex> lock(player_data_mutex);  // åŠ é”
        // ä¿®æ”¹å…±äº«çš„ç©å®¶æ•°æ®
        player_data[player_id] = new_data;
    }  // è‡ªåŠ¨è§£é”
}

// åˆ›å»º1000ä¸ªçº¿ç¨‹ï¼Ÿå†…å­˜çˆ†ç‚¸ï¼
// é€šå¸¸ç”¨çº¿ç¨‹æ± ï¼Œæ¯”å¦‚10ä¸ªçº¿ç¨‹å¤„ç†1000ä¸ªä»»åŠ¡
```

#### Skynetåç¨‹å¤„ç†1000ä¸ªç©å®¶ï¼š
```lua
-- Skynetåç¨‹ç¤ºä¾‹
-- å¯ä»¥è½»æ¾åˆ›å»º1000ä¸ªåç¨‹ï¼Œæ¯ä¸ªç©å®¶ä¸€ä¸ª
skynet.start(function()
    for player_id = 1, 1000 do
        -- æ¯ä¸ªç©å®¶ä¸€ä¸ªç‹¬ç«‹çš„åç¨‹æœåŠ¡
        local player_agent = skynet.newservice("player_agent", player_id)
        
        -- æ— éœ€é”ï¼Œé€šè¿‡æ¶ˆæ¯ä¼ é€’é€šä¿¡
        skynet.send(player_agent, "lua", "init_player", player_data)
    end
end)

-- ç©å®¶ä»£ç†æœåŠ¡ï¼ˆåç¨‹ï¼‰
-- service/player_agent.lua
local skynet = require "skynet"

skynet.start(function()
    local player_id = ...
    local player_data = {}  -- æ¯ä¸ªåç¨‹æœ‰ç‹¬ç«‹æ•°æ®ï¼Œæ— å…±äº«
    
    skynet.dispatch("lua", function(session, address, cmd, ...)
        if cmd == "init_player" then
            player_data = ...  -- ç›´æ¥ä¿®æ”¹ï¼Œæ— éœ€é”
            skynet.ret(skynet.pack("ok"))
        elseif cmd == "update_level" then
            player_data.level = ...  -- å®‰å…¨ä¿®æ”¹
            skynet.ret(skynet.pack("updated"))
        end
    end)
end)
```

### ğŸ”„ **æ‰§è¡Œæ¨¡å‹å¯¹æ¯”**

#### çº¿ç¨‹æ¨¡å‹ï¼š
```
æ—¶é—´è½´ â†’
çº¿ç¨‹A: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
çº¿ç¨‹B:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
çº¿ç¨‹C:         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
çº¿ç¨‹D:             â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

é—®é¢˜ï¼š
â€¢ éœ€è¦é”åŒæ­¥ ğŸ”’
â€¢ ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§ ğŸ’°
â€¢ è°ƒè¯•å›°éš¾ ğŸ›
```

#### åç¨‹æ¨¡å‹ï¼š
```
æ—¶é—´è½´ â†’
å·¥ä½œçº¿ç¨‹: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
åç¨‹A:    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ
åç¨‹B:      â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ
åç¨‹C:        â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ
åç¨‹D:          â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ    â–ˆâ–ˆ

ä¼˜ç‚¹ï¼š
â€¢ ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒ âœ‹
â€¢ åˆ‡æ¢å¼€é”€æå° âš¡
â€¢ æ— é”ç¼–ç¨‹ ğŸ”“
```

### ğŸ® **æ¸¸æˆå¼€å‘ä¸­çš„å®é™…åº”ç”¨**

#### ä¼ ç»Ÿå¤šçº¿ç¨‹æ¸¸æˆæœåŠ¡å™¨ï¼š
```
ä¸»çº¿ç¨‹ï¼šå¤„ç†ç½‘ç»œIO
AIçº¿ç¨‹ï¼šè®¡ç®—AIé€»è¾‘  
ç‰©ç†çº¿ç¨‹ï¼šç‰©ç†æ¨¡æ‹Ÿ
æ¸²æŸ“çº¿ç¨‹ï¼šå›¾å½¢æ¸²æŸ“

é—®é¢˜ï¼š
â€¢ çº¿ç¨‹é—´æ•°æ®åŒæ­¥å¤æ‚
â€¢ å®¹æ˜“å‡ºç°æ­»é”
â€¢ è°ƒè¯•å›°éš¾
```

#### Skynetåç¨‹æ¸¸æˆæœåŠ¡å™¨ï¼š
```lua
-- æ¯ä¸ªç³»ç»Ÿéƒ½æ˜¯ç‹¬ç«‹çš„åç¨‹æœåŠ¡
local ai_mgr = skynet.uniqueservice("ai_manager")
local physics_mgr = skynet.uniqueservice("physics_manager") 
local net_mgr = skynet.uniqueservice("network_manager")

-- æ¯ä¸ªç©å®¶éƒ½æ˜¯ç‹¬ç«‹çš„åç¨‹
for i = 1, 1000 do
    local player = skynet.newservice("player_agent", i)
end

-- é€šè¿‡æ¶ˆæ¯ä¼ é€’åè°ƒï¼Œæ— éœ€é”
skynet.send(ai_mgr, "lua", "update_ai", ai_data)
skynet.send(physics_mgr, "lua", "simulate", physics_data)
```

### âš¡ **ä¸ºä»€ä¹ˆSkyneté€‰æ‹©åç¨‹ï¼Ÿ**

1. **æ¸¸æˆæœåŠ¡å™¨ç‰¹ç‚¹ï¼š**
   - éœ€è¦å¤„ç†å¤§é‡è¿æ¥ï¼ˆå‡ åƒåˆ°å‡ ä¸‡ç©å®¶ï¼‰
   - æ¯ä¸ªè¿æ¥çš„é€»è¾‘ç›¸å¯¹ç®€å•
   - IOå¯†é›†å‹å¤šäºCPUå¯†é›†å‹

2. **åç¨‹ä¼˜åŠ¿ï¼š**
   - å¯ä»¥è½»æ¾åˆ›å»ºå‡ ä¸‡ä¸ªåç¨‹
   - å†…å­˜å ç”¨å°
   - æ— é”ç¼–ç¨‹ï¼Œå‡å°‘bug
   - æ¶ˆæ¯ä¼ é€’æ¨¡å‹é€‚åˆæ¸¸æˆé€»è¾‘

3. **æœ€ä½³å®è·µï¼š**
   ```lua
   -- Skynetï¼šå°‘é‡OSçº¿ç¨‹ + å¤§é‡åç¨‹
   thread = 8  -- é…ç½®æ–‡ä»¶ä¸­è®¾ç½®8ä¸ªå·¥ä½œçº¿ç¨‹
   
   -- ä½†å¯ä»¥åˆ›å»ºå‡ ä¸‡ä¸ªåç¨‹æœåŠ¡
   for i = 1, 50000 do
       local service = skynet.newservice("micro_service", i)
   end
   ```

### ğŸ¯ **æ€»ç»“**

**æ‚¨å¯¹çº¿ç¨‹çš„ç†è§£å®Œå…¨æ­£ç¡®ï¼** è€Œåç¨‹æ˜¯å¦ä¸€ç§å¹¶å‘æ¨¡å‹ï¼š

- **çº¿ç¨‹ = æŠ¢å å¼å¹¶è¡Œ**ï¼ˆOSè°ƒåº¦ï¼ŒçœŸå¹¶è¡Œï¼Œéœ€è¦é”ï¼‰
- **åç¨‹ = åä½œå¼å¹¶å‘**ï¼ˆç¨‹åºè°ƒåº¦ï¼Œæ¶ˆæ¯ä¼ é€’ï¼Œæ— é”ï¼‰

**Skyneté€‰æ‹©åç¨‹æ˜¯å› ä¸ºï¼š**
1. é€‚åˆæ¸¸æˆæœåŠ¡å™¨çš„IOå¯†é›†ç‰¹æ€§
2. å¯ä»¥è½»æ¾å¤„ç†å¤§é‡è¿æ¥
3. ç¼–ç¨‹æ›´ç®€å•å®‰å…¨
4. ä»ç„¶èƒ½é€šè¿‡å°‘é‡å·¥ä½œçº¿ç¨‹åˆ©ç”¨å¤šæ ¸

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¯´Skynetçš„newserviceåˆ›å»ºçš„æ˜¯"åç¨‹æœåŠ¡"è€Œä¸æ˜¯"çº¿ç¨‹"çš„åŸå› ï¼

### ğŸ’¡ **æ‚¨çš„ç†è§£å·²ç»å¾ˆç²¾å‡†äº†ï¼**

æ‚¨è¯´"åç¨‹å…¶å®æ˜¯å•çº¿ç¨‹æ‰§è¡Œçš„ï¼Œä½†æ˜¯åç¨‹ä¼šä¸»åŠ¨åœæ­¢ï¼Œè®©å‡ºcpuï¼Œè®©å…¶ä»–åç¨‹å·¥ä½œï¼Œå®ç°ç±»ä¼¼å¤šçº¿ç¨‹çš„åŠŸèƒ½"â€”â€”è¿™ä¸ªç†è§£éå¸¸æ£’ï¼

ä¸è¿‡è®©æˆ‘åšä¸€ä¸ªå°çš„è¡¥å……æ¾„æ¸…ï¼š

### ğŸ”§ **Skynetçš„ç²¾ç¡®æ¨¡å‹**

```
âœ… æ‚¨ç†è§£çš„åŸºæœ¬æ­£ç¡®ï¼š
- åç¨‹ä¼šä¸»åŠ¨è®©å‡ºCPU
- å®ç°ç±»ä¼¼å¤šçº¿ç¨‹çš„å¹¶å‘æ•ˆæœ
- é¿å…äº†ä¼ ç»Ÿå¤šçº¿ç¨‹çš„å¤æ‚æ€§

ğŸ”§ å°ç»†èŠ‚è¡¥å……ï¼š
Skynetå®é™…ä¸Šæ˜¯"å°‘é‡çº¿ç¨‹ + å¤§é‡åç¨‹"çš„æ··åˆæ¨¡å‹
```

#### Skynetçš„çœŸå®æ¶æ„ï¼š
```
ç‰©ç†æœºå™¨ï¼ˆæ¯”å¦‚8æ ¸CPUï¼‰
â”œâ”€â”€ Skynetè¿›ç¨‹
    â”œâ”€â”€ å·¥ä½œçº¿ç¨‹1 â”€â”€â”€â”€â”
    â”œâ”€â”€ å·¥ä½œçº¿ç¨‹2      â”‚ â† è¿™äº›æ˜¯çœŸæ­£çš„OSçº¿ç¨‹ï¼ˆé€šå¸¸4-8ä¸ªï¼‰
    â”œâ”€â”€ å·¥ä½œçº¿ç¨‹3      â”‚
    â”œâ”€â”€ å·¥ä½œçº¿ç¨‹4 â”€â”€â”€â”€â”˜
    â”‚
    â””â”€â”€ åç¨‹è°ƒåº¦å™¨
        â”œâ”€â”€ åç¨‹A â”€â”€â”€â”€â”
        â”œâ”€â”€ åç¨‹B      â”‚ â† è¿™äº›åç¨‹åˆ†å¸ƒåˆ°ä¸Šé¢çš„å·¥ä½œçº¿ç¨‹ä¸Šæ‰§è¡Œ
        â”œâ”€â”€ åç¨‹C      â”‚   (å¯ä»¥æœ‰å‡ ä¸‡ä¸ª)
        â”œâ”€â”€ åç¨‹D â”€â”€â”€â”€â”˜
        â””â”€â”€ ...
```

### ğŸ“Š **ä¸‰ç§æ¨¡å‹å¯¹æ¯”**

#### 1. ä¼ ç»Ÿå•çº¿ç¨‹ï¼ˆæ‚¨è¯´çš„ç¬¬ä¸€ç§ç†è§£ï¼‰
```
CPU: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
ä»»åŠ¡: Aâ†’â†’â†’Bâ†’â†’â†’Câ†’â†’â†’Dâ†’â†’â†’Aâ†’â†’â†’Bâ†’â†’â†’Câ†’â†’â†’D

ç‰¹ç‚¹ï¼šçœŸæ­£çš„å•çº¿ç¨‹ï¼Œä»»åŠ¡æ’é˜Ÿæ‰§è¡Œ
```

#### 2. ä¼ ç»Ÿå¤šçº¿ç¨‹
```
CPU1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (çº¿ç¨‹A)
CPU2: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (çº¿ç¨‹B)  
CPU3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (çº¿ç¨‹C)
CPU4: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ (çº¿ç¨‹D)

ç‰¹ç‚¹ï¼šçœŸæ­£å¹¶è¡Œï¼Œä½†éœ€è¦é”åŒæ­¥
```

#### 3. Skynetåç¨‹æ¨¡å‹ï¼ˆå®é™…æƒ…å†µï¼‰
```
å·¥ä½œçº¿ç¨‹1: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
åç¨‹:      Aâ†’Bâ†’Câ†’Aâ†’Dâ†’Bâ†’Câ†’Aâ†’Dâ†’Bâ†’C...

å·¥ä½œçº¿ç¨‹2: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  
åç¨‹:      Eâ†’Fâ†’Gâ†’Eâ†’Hâ†’Fâ†’Gâ†’Eâ†’Hâ†’Fâ†’G...

å·¥ä½œçº¿ç¨‹3: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
åç¨‹:      Iâ†’Jâ†’Kâ†’Iâ†’Lâ†’Jâ†’Kâ†’Iâ†’Lâ†’Jâ†’K...

ç‰¹ç‚¹ï¼šå¤šçº¿ç¨‹ + åç¨‹è°ƒåº¦ï¼Œæ—¢æœ‰å¹¶è¡Œåˆé¿å…é”
```

### ğŸ¯ **åç¨‹è®©å‡ºCPUçš„æ—¶æœº**

æ‚¨è¯´åç¨‹"ä¸»åŠ¨åœæ­¢"æ˜¯å¯¹çš„ï¼å…·ä½“æ¥è¯´ï¼š

```lua
-- åç¨‹åœ¨è¿™äº›æ—¶å€™ä¼šä¸»åŠ¨è®©å‡ºCPUï¼š
skynet.call(other_service, "lua", "request")  -- ç­‰å¾…å…¶ä»–æœåŠ¡å›å¤
skynet.sleep(100)                             -- ä¸»åŠ¨ä¼‘çœ 
socket.read(fd)                               -- ç­‰å¾…ç½‘ç»œIO
db:query("SELECT * FROM users")               -- ç­‰å¾…æ•°æ®åº“æŸ¥è¯¢

-- è®©å‡ºæœŸé—´ï¼Œè¯¥å·¥ä½œçº¿ç¨‹å¯ä»¥è¿è¡Œå…¶ä»–åç¨‹
```

### ğŸ’¡ **å½¢è±¡æ¯”å–»**

æƒ³è±¡ä¸€ä¸ªå®¢æœä¸­å¿ƒï¼š

#### ä¼ ç»Ÿå¤šçº¿ç¨‹æ¨¡å¼ï¼š
```
å®¢æœ1: ä¸“é—¨å¤„ç†ç”¨æˆ·Açš„æ‰€æœ‰é—®é¢˜
å®¢æœ2: ä¸“é—¨å¤„ç†ç”¨æˆ·Bçš„æ‰€æœ‰é—®é¢˜  
å®¢æœ3: ä¸“é—¨å¤„ç†ç”¨æˆ·Cçš„æ‰€æœ‰é—®é¢˜
...

é—®é¢˜ï¼šæ¯ä¸ªå®¢æœåªèƒ½æœåŠ¡ä¸€ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·å¤šäº†å®¢æœä¸å¤Ÿç”¨
```

#### Skynetåç¨‹æ¨¡å¼ï¼š
```
é«˜æ•ˆå®¢æœ1: å¤„ç†ç”¨æˆ·Aé—®é¢˜ â†’ ç­‰å¾…æ—¶åˆ‡æ¢åˆ°ç”¨æˆ·E â†’ ç­‰å¾…æ—¶åˆ‡æ¢åˆ°ç”¨æˆ·I...
é«˜æ•ˆå®¢æœ2: å¤„ç†ç”¨æˆ·Bé—®é¢˜ â†’ ç­‰å¾…æ—¶åˆ‡æ¢åˆ°ç”¨æˆ·F â†’ ç­‰å¾…æ—¶åˆ‡æ¢åˆ°ç”¨æˆ·J...
é«˜æ•ˆå®¢æœ3: å¤„ç†ç”¨æˆ·Cé—®é¢˜ â†’ ç­‰å¾…æ—¶åˆ‡æ¢åˆ°ç”¨æˆ·G â†’ ç­‰å¾…æ—¶åˆ‡æ¢åˆ°ç”¨æˆ·K...
é«˜æ•ˆå®¢æœ4: å¤„ç†ç”¨æˆ·Dé—®é¢˜ â†’ ç­‰å¾…æ—¶åˆ‡æ¢åˆ°ç”¨æˆ·H â†’ ç­‰å¾…æ—¶åˆ‡æ¢åˆ°ç”¨æˆ·L...

ä¼˜ç‚¹ï¼šå°‘é‡é«˜æ•ˆå®¢æœå¯ä»¥æœåŠ¡å¤§é‡ç”¨æˆ·ï¼Œæ— ç¼åˆ‡æ¢
```

### ğŸš€ **å®é™…ä»£ç ç¤ºä¾‹**

```lua
-- ç©å®¶æœåŠ¡åç¨‹
skynet.start(function()
    local player_id = ...
    
    while true do
        -- å¤„ç†ç©å®¶è¯·æ±‚
        local cmd, data = skynet.call(client, "lua", "get_request")
        
        if cmd == "move" then
            -- å¤„ç†ç§»åŠ¨é€»è¾‘
            process_move(data)
        elseif cmd == "attack" then
            -- æŸ¥è¯¢æ•°æ®åº“ï¼ˆè¿™é‡Œä¼šè®©å‡ºCPUï¼‰
            local weapon_data = skynet.call(db_service, "lua", "get_weapon", player_id)
            
            -- ç»§ç»­å¤„ç†æ”»å‡»
            process_attack(data, weapon_data)
        end
        
        -- ä¸»åŠ¨ä¼‘çœ ä¸€ä¸‹ï¼Œè®©å…¶ä»–åç¨‹å·¥ä½œï¼ˆè¿™é‡Œä¼šè®©å‡ºCPUï¼‰
        skynet.sleep(1)
    end
end)
```

### ğŸ¯ **æ‚¨çš„ç†è§£æ€»ç»“**

**âœ… å®Œå…¨æ­£ç¡®çš„éƒ¨åˆ†ï¼š**
- åç¨‹ä¼šä¸»åŠ¨è®©å‡ºCPU
- å®ç°ç±»ä¼¼å¤šçº¿ç¨‹çš„å¹¶å‘æ•ˆæœ
- é¿å…äº†é”çš„å¤æ‚æ€§

**ğŸ”§ è¡¥å……çš„ç»†èŠ‚ï¼š**
- Skynetæ˜¯"å°‘é‡å·¥ä½œçº¿ç¨‹ + å¤§é‡åç¨‹"çš„ç»„åˆ
- æ—¢æœ‰çœŸæ­£çš„å¤šæ ¸å¹¶è¡Œï¼Œåˆæœ‰åç¨‹çš„ç®€æ´æ€§
- è¿™æ˜¯ç°ä»£é«˜æ€§èƒ½æœåŠ¡å™¨çš„æœ€ä½³å®è·µ

**æ‚¨çš„æ ¸å¿ƒç†è§£å·²ç»å®Œå…¨æ­£ç¡®äº†ï¼**è¿™ç§è®¾è®¡è®©Skynetæ—¢èƒ½åˆ©ç”¨å¤šæ ¸æ€§èƒ½ï¼Œåˆèƒ½è½»æ¾å¤„ç†å¤§é‡è¿æ¥ï¼Œæ˜¯éå¸¸èªæ˜çš„æ¶æ„é€‰æ‹©ï¼

## ğŸ”§ åç¨‹åˆ›å»ºä¸è°ƒåº¦æœºåˆ¶è¯¦è§£

### ğŸ’¡ **æ‚¨æå‡ºäº†éå¸¸æ ¸å¿ƒçš„é—®é¢˜ï¼**

å…³äºåç¨‹å¦‚ä½•åˆ›å»ºã€åˆ†é…ä»¥åŠåœ¨çº¿ç¨‹é—´çš„è¿è¡Œæœºåˆ¶ï¼Œè¿™æ˜¯Skynetæ¶æ„çš„ç²¾é«“éƒ¨åˆ†ã€‚

### ğŸ“Š **Skynetçš„åç¨‹è°ƒåº¦åŸç†**

#### 1ï¸âƒ£ **åç¨‹åˆ›å»ºä¸åˆ†é…æœºåˆ¶**

```lua
-- å½“æ‚¨è°ƒç”¨ newservice æ—¶å‘ç”Ÿäº†ä»€ä¹ˆï¼š
local service = skynet.newservice("player_agent", player_id)

-- å†…éƒ¨æµç¨‹ï¼š
-- 1. åˆ›å»ºæ–°çš„åç¨‹æœåŠ¡å®ä¾‹
-- 2. åˆ†é…å”¯ä¸€çš„æœåŠ¡åœ°å€ID  
-- 3. å°†åç¨‹æ”¾å…¥å…¨å±€è°ƒåº¦é˜Ÿåˆ—
-- 4. ç­‰å¾…å·¥ä½œçº¿ç¨‹è°ƒåº¦æ‰§è¡Œ
```

#### Skynetçš„è°ƒåº¦æ¨¡å‹ï¼š

```
å…¨å±€è°ƒåº¦å™¨ (å•ä¸€è°ƒåº¦é˜Ÿåˆ—)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [åç¨‹A] [åç¨‹B] [åç¨‹C] [åç¨‹D] ... â”‚ â† æ‰€æœ‰åç¨‹éƒ½åœ¨è¿™ä¸ªé˜Ÿåˆ—ä¸­
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ åŠ¨æ€åˆ†é…
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼        â–¼        â–¼
    å·¥ä½œçº¿ç¨‹1  å·¥ä½œçº¿ç¨‹2  å·¥ä½œçº¿ç¨‹3
    æ‰§è¡Œåç¨‹A  æ‰§è¡Œåç¨‹B  æ‰§è¡Œåç¨‹C
```

**å…³é”®ç‰¹ç‚¹ï¼š**
- âœ… **åŠ¨æ€åˆ†é…ï¼š** ä¸æ˜¯å›ºå®šç»‘å®šï¼Œè€Œæ˜¯æ ¹æ®è´Ÿè½½åŠ¨æ€åˆ†é…
- âœ… **è´Ÿè½½å‡è¡¡ï¼š** ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ä¼šè‡ªåŠ¨è·å–å¾…æ‰§è¡Œçš„åç¨‹
- âœ… **æ— ç»‘å®šå…³ç³»ï¼š** åç¨‹ä¸å±äºç‰¹å®šçº¿ç¨‹

### ğŸ”„ **åç¨‹åœ¨çº¿ç¨‹é—´çš„è¿ç§»**

#### âœ… **æ‚¨çš„çŒœæµ‹æ˜¯å¯¹çš„ï¼**

åç¨‹ç¡®å®å¯ä»¥åœ¨ä¸åŒçº¿ç¨‹é—´è¿è¡Œï¼š

```
æ—¶é—´çº¿ï¼š
T1æ—¶åˆ»: åç¨‹Aåœ¨å·¥ä½œçº¿ç¨‹1æ‰§è¡Œ
T2æ—¶åˆ»: åç¨‹Aè®©å‡ºCPU (ç­‰å¾…IO)
T3æ—¶åˆ»: åç¨‹Aåœ¨å·¥ä½œçº¿ç¨‹3æ‰§è¡Œ â† å¯èƒ½æ¢äº†çº¿ç¨‹ï¼
```

#### å…·ä½“ä¾‹å­ï¼š

```lua
-- ç©å®¶æœåŠ¡åç¨‹çš„ç”Ÿå‘½å‘¨æœŸ
skynet.start(function()
    local player_id = ...
    
    -- æ­¤æ—¶å¯èƒ½åœ¨å·¥ä½œçº¿ç¨‹1æ‰§è¡Œ
    local weapon_data = skynet.call(db_service, "lua", "get_weapon", player_id)
    -- â†‘ è¿™é‡Œåç¨‹è®©å‡ºCPUï¼Œç­‰å¾…æ•°æ®åº“å›å¤
    
    -- å½“æ•°æ®åº“å›å¤æ—¶ï¼Œåç¨‹è¢«é‡æ–°è°ƒåº¦
    -- æ­¤æ—¶å¯èƒ½åœ¨å·¥ä½œçº¿ç¨‹2æ‰§è¡Œï¼
    process_weapon_data(weapon_data)
    
    -- ä¸»åŠ¨ä¼‘çœ 
    skynet.sleep(100)
    -- â†‘ å†æ¬¡è®©å‡ºCPU
    
    -- 100msåè¢«å”¤é†’ï¼Œå¯èƒ½åˆåœ¨å·¥ä½œçº¿ç¨‹3æ‰§è¡Œ
    continue_processing()
end)
```

### ğŸ”’ **èµ„æºç«äº‰é—®é¢˜è§£å†³**

#### âŒ **ä¸ä¼šäº§ç”Ÿä¼ ç»Ÿçš„å¤šçº¿ç¨‹ç«äº‰é—®é¢˜ï¼**

**åŸå› ï¼š**

1. **æ¶ˆæ¯ä¼ é€’æ¨¡å‹ï¼š**
```lua
-- åç¨‹é—´ä¸å…±äº«å†…å­˜ï¼Œåªé€šè¿‡æ¶ˆæ¯é€šä¿¡
skynet.send(other_service, "lua", "update_data", data)  -- å‘é€å‰¯æœ¬
-- è€Œä¸æ˜¯: shared_data.value = new_value  -- å…±äº«å†…å­˜ä¿®æ”¹
```

2. **åç¨‹çŠ¶æ€å°è£…ï¼š**
```lua
-- æ¯ä¸ªåç¨‹çš„æ•°æ®éƒ½æ˜¯ç‹¬ç«‹çš„
skynet.start(function()
    local my_data = {}  -- è¿™ä¸ªæ•°æ®åªå±äºå½“å‰åç¨‹
    local player_id = ...  -- å‚æ•°ä¹Ÿæ˜¯ç‹¬ç«‹çš„
    
    -- å³ä½¿åç¨‹åœ¨ä¸åŒçº¿ç¨‹æ‰§è¡Œï¼Œmy_dataå§‹ç»ˆè·Ÿéšåç¨‹
end)
```

3. **åŸå­æ€§ä¿è¯ï¼š**
```lua
-- åç¨‹åªåœ¨ä»¥ä¸‹æ—¶æœºè®©å‡ºCPUï¼š
skynet.call()   -- ä¸»åŠ¨è°ƒç”¨
skynet.send()   -- ä¸»åŠ¨å‘é€
skynet.sleep()  -- ä¸»åŠ¨ä¼‘çœ 
socket.read()   -- ç­‰å¾…IO

-- ä¸ä¼šåœ¨æ‰§è¡Œä»£ç ä¸­é€”è¢«å¼ºåˆ¶åˆ‡æ¢
local x = player_data.level
local y = x + 1  -- è¿™é‡Œä¸ä¼šè¢«æ‰“æ–­
player_data.level = y  -- åŸå­æ€§æ“ä½œ
```

### ğŸ—ï¸ **Skynetçš„å†…å­˜æ¨¡å‹**

```
å·¥ä½œçº¿ç¨‹1              å·¥ä½œçº¿ç¨‹2              å·¥ä½œçº¿ç¨‹3
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚      â”‚             â”‚      â”‚             â”‚
â”‚             â”‚      â”‚             â”‚      â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                      â”‚                      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚         å…±äº«æ¶ˆæ¯é˜Ÿåˆ—            â”‚
              â”‚    (åªä¼ é€’æ¶ˆæ¯ï¼Œä¸å…±äº«çŠ¶æ€)     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åç¨‹Açš„æ•°æ® â”€â”€â”€â”€â”€â”€ è·Ÿéšåç¨‹Aç§»åŠ¨ â”€â”€â”€â”€â”€â”€â–¶ æ— è®ºåœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œ
åç¨‹Bçš„æ•°æ® â”€â”€â”€â”€â”€â”€ è·Ÿéšåç¨‹Bç§»åŠ¨ â”€â”€â”€â”€â”€â”€â–¶ éƒ½ä¿æŒæ•°æ®ç‹¬ç«‹æ€§
```

### ğŸ’» **å®é™…è°ƒåº¦ä»£ç ç¤ºä¾‹**

```lua
-- === åç¨‹è°ƒåº¦æ¼”ç¤º ===
-- åˆ›å»ºå¤šä¸ªæœåŠ¡æ¥è§‚å¯Ÿè°ƒåº¦
skynet.start(function()
    local services = {}
    
    -- åˆ›å»º10ä¸ªå·¥ä½œæœåŠ¡
    for i = 1, 10 do
        services[i] = skynet.newservice("worker", i)
    end
    
    -- å‘é€ä»»åŠ¡ç»™æ‰€æœ‰æœåŠ¡
    for i = 1, 10 do
        skynet.send(services[i], "lua", "work", "task_" .. i)
    end
end)

-- === å·¥ä½œæœåŠ¡ (service/worker.lua) ===
local skynet = require "skynet"

skynet.start(function()
    local worker_id = ...
    local task_count = 0
    
    skynet.dispatch("lua", function(session, address, cmd, task_name)
        if cmd == "work" then
            task_count = task_count + 1
            
            -- è¾“å‡ºå½“å‰çº¿ç¨‹ä¿¡æ¯ï¼ˆä»…ç”¨äºæ¼”ç¤ºï¼‰
            skynet.error(string.format("Worker %d processing %s (task #%d)", 
                        worker_id, task_name, task_count))
            
            -- æ¨¡æ‹Ÿä¸€äº›å·¥ä½œ
            for i = 1, 1000000 do
                -- è®¡ç®—å·¥ä½œ
            end
            
            -- ä¸»åŠ¨è®©å‡ºï¼Œè§‚å¯Ÿæ˜¯å¦ä¼šåœ¨ä¸åŒçº¿ç¨‹é‡æ–°æ‰§è¡Œ
            skynet.sleep(10)
            
            skynet.error(string.format("Worker %d finished %s", 
                        worker_id, task_name))
            
            skynet.ret(skynet.pack("done"))
        end
    end)
end)
```

### ğŸ¯ **å…³é”®è®¾è®¡åŸåˆ™**

Skyneté€šè¿‡ä»¥ä¸‹è®¾è®¡é¿å…äº†å¤šçº¿ç¨‹ç«äº‰ï¼š

1. **Share Nothingï¼š** åç¨‹é—´ä¸å…±äº«ä»»ä½•çŠ¶æ€
2. **Message Passingï¼š** åªé€šè¿‡æ¶ˆæ¯ä¼ é€’é€šä¿¡  
3. **Atomic Executionï¼š** åç¨‹æ‰§è¡Œå…·æœ‰åŸå­æ€§
4. **Cooperative Schedulingï¼š** åç¨‹ä¸»åŠ¨è®©å‡ºæ§åˆ¶æƒ

### ğŸ“Š **æ€»ç»“å›ç­”æ‚¨çš„é—®é¢˜**

| é—®é¢˜ | ç­”æ¡ˆ |
|------|------|
| **åç¨‹å¦‚ä½•åˆ›å»ºï¼Ÿ** | åŠ¨æ€åˆ›å»ºï¼Œæ”¾å…¥å…¨å±€è°ƒåº¦é˜Ÿåˆ— |
| **å¦‚ä½•åˆ†é…åˆ°çº¿ç¨‹ï¼Ÿ** | è´Ÿè½½å‡è¡¡ï¼Œç©ºé—²çº¿ç¨‹è‡ªåŠ¨è·å– |
| **åç¨‹èƒ½è·¨çº¿ç¨‹è¿è¡Œå—ï¼Ÿ** | âœ… å¯ä»¥ï¼æ¯æ¬¡è°ƒåº¦å¯èƒ½åœ¨ä¸åŒçº¿ç¨‹ |
| **ä¼šæœ‰èµ„æºç«äº‰å—ï¼Ÿ** | âŒ ä¸ä¼šï¼æ¶ˆæ¯ä¼ é€’+çŠ¶æ€éš”ç¦» |
| **ç»‘å®šå…³ç³»ï¼Ÿ** | æ— å›ºå®šç»‘å®šï¼Œå®Œå…¨åŠ¨æ€è°ƒåº¦ |

**è¿™å°±æ˜¯Skynetèƒ½å¤Ÿè½»æ¾å¤„ç†å‡ ä¸‡ä¸ªåç¨‹çš„ç§˜å¯†ï¼** ğŸš€

---

### skynet.queryservice(name)
æŸ¥è¯¢å·²å­˜åœ¨çš„å”¯ä¸€æœåŠ¡ã€‚

**åŠŸèƒ½è¯´æ˜ï¼š**
æŸ¥æ‰¾æŒ‡å®šåç§°çš„å”¯ä¸€æœåŠ¡ï¼Œå¦‚æœæœåŠ¡ä¸å­˜åœ¨ä¼šä¸€ç›´é˜»å¡ç­‰å¾…ï¼Œç›´åˆ°è¯¥æœåŠ¡è¢«åˆ›å»ºã€‚

**å‚æ•°è¯¦è§£ï¼š**
- `name` (string): è¦æŸ¥è¯¢çš„å”¯ä¸€æœåŠ¡åç§°

**è¿”å›å€¼ï¼š**
- è¿”å›æ‰¾åˆ°çš„æœåŠ¡åœ°å€ID

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```lua
-- åœ¨å…¶ä»–åœ°æ–¹åˆ›å»ºå”¯ä¸€æœåŠ¡
-- skynet.uniqueservice("database")

-- æŸ¥è¯¢å·²å­˜åœ¨çš„å”¯ä¸€æœåŠ¡
local db_service = skynet.queryservice("database")
skynet.error("Found database service:", db_service)

-- æ³¨æ„ï¼šå¦‚æœæœåŠ¡ä¸å­˜åœ¨ï¼Œè¿™é‡Œä¼šä¸€ç›´é˜»å¡ç­‰å¾…
```

### skynet.kill(service_id)
ç»ˆæ­¢æŒ‡å®šçš„æœåŠ¡ã€‚

**åŠŸèƒ½è¯´æ˜ï¼š**
å¼ºåˆ¶æ€æ­»æŒ‡å®šåœ°å€çš„æœåŠ¡ï¼ŒæœåŠ¡ä¼šç«‹å³åœæ­¢è¿è¡Œã€‚

**å‚æ•°è¯¦è§£ï¼š**
- `service_id` (integer): è¦ç»ˆæ­¢çš„æœåŠ¡åœ°å€ID

**è¿”å›å€¼ï¼š**
- æ— è¿”å›å€¼

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```lua
local worker = skynet.newservice("worker")
skynet.error("Created worker:", worker)

-- å·¥ä½œå®Œæˆåç»ˆæ­¢æœåŠ¡
skynet.kill(worker)
skynet.error("Worker terminated")
```

**æ³¨æ„äº‹é¡¹ï¼š**
- è¢«killçš„æœåŠ¡ä¸ä¼šæ‰§è¡Œæ¸…ç†ä»£ç 
- å»ºè®®ä¼˜å…ˆä½¿ç”¨æ¶ˆæ¯é€šçŸ¥æœåŠ¡è‡ªè¡Œé€€å‡ºï¼Œè€Œä¸æ˜¯å¼ºåˆ¶kill

### skynet.self()
è·å–å½“å‰æœåŠ¡çš„åœ°å€IDã€‚

**åŠŸèƒ½è¯´æ˜ï¼š**
è¿”å›å½“å‰è¿è¡Œä»£ç æ‰€åœ¨æœåŠ¡çš„å”¯ä¸€åœ°å€æ ‡è¯†ã€‚

**å‚æ•°ï¼š**
- æ— å‚æ•°

**è¿”å›å€¼ï¼š**
- å½“å‰æœåŠ¡çš„åœ°å€IDï¼ˆæ•´æ•°ï¼‰

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```lua
skynet.start(function()
    local my_address = skynet.self()
    skynet.error("My service address is:", my_address)
    
    -- å¯ä»¥å°†è‡ªå·±çš„åœ°å€å‘é€ç»™å…¶ä»–æœåŠ¡
    skynet.send(other_service, "lua", "register", my_address)
end)
```

### skynet.localname(name)
é€šè¿‡æœ¬åœ°æ³¨å†Œåç§°è·å–æœåŠ¡åœ°å€ã€‚

**åŠŸèƒ½è¯´æ˜ï¼š**
è·å–é€šè¿‡ `skynet.register()` æ³¨å†Œçš„æœ¬åœ°æœåŠ¡åœ°å€ã€‚

**å‚æ•°è¯¦è§£ï¼š**
- `name` (string): æœ¬åœ°æ³¨å†Œçš„æœåŠ¡åç§°ï¼Œé€šå¸¸ä»¥"."å¼€å¤´

**è¿”å›å€¼ï¼š**
- è¿”å›å¯¹åº”çš„æœåŠ¡åœ°å€IDï¼Œå¦‚æœä¸å­˜åœ¨è¿”å›nil

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```lua
-- è·å–ç³»ç»Ÿå†…ç½®æœåŠ¡
local launcher = skynet.localname(".launcher")
local csservice = skynet.localname(".csservice") 

skynet.error("Launcher address:", launcher)

-- è‡ªå®šä¹‰æ³¨å†ŒæœåŠ¡åç§°
skynet.register(".myservice")
-- åœ¨å…¶ä»–åœ°æ–¹å¯ä»¥é€šè¿‡åç§°è·å–
local my_service = skynet.localname(".myservice")
```

**æœåŠ¡åˆ›å»ºå®Œæ•´ç¤ºä¾‹ï¼š**

```lua
-- === æœåŠ¡æ–‡ä»¶ç¤ºä¾‹ service/worker.lua ===
local skynet = require "skynet"

-- æœåŠ¡å¯åŠ¨å‡½æ•°
skynet.start(function()
    -- è·å–å¯åŠ¨å‚æ•°
    local worker_id = ... -- ç¬¬ä¸€ä¸ªå‚æ•°
    local config = ... -- ç¬¬äºŒä¸ªå‚æ•°
    
    skynet.error("Worker " .. worker_id .. " started with config:", config)
    
    -- æ³¨å†Œæ¶ˆæ¯å¤„ç†å‡½æ•°
    skynet.dispatch("lua", function(session, address, cmd, ...)
        if cmd == "work" then
            local task = ...
            skynet.error("Worker " .. worker_id .. " processing task:", task)
            skynet.ret(skynet.pack("done", task .. "_processed"))
        elseif cmd == "stop" then
            skynet.error("Worker " .. worker_id .. " stopping")
            skynet.exit()
        end
    end)
end)

-- === ä¸»æœåŠ¡ä¸­åˆ›å»ºå’Œä½¿ç”¨æœåŠ¡ ===
skynet.start(function()
    -- 1. åˆ›å»ºæ™®é€šæœåŠ¡ï¼ˆå¯åˆ›å»ºå¤šä¸ªï¼‰
    local worker1 = skynet.newservice("worker", "worker_1", {type = "fast"})
    local worker2 = skynet.newservice("worker", "worker_2", {type = "slow"})
    
    -- 2. åˆ›å»ºå”¯ä¸€æœåŠ¡ï¼ˆå…¨å±€å•ä¾‹ï¼‰
    local db_mgr = skynet.uniqueservice("db_manager")
    
    -- 3. ä½¿ç”¨æœåŠ¡
    local result1 = skynet.call(worker1, "lua", "work", "task_data_1")
    local result2 = skynet.call(worker2, "lua", "work", "task_data_2")
    
    skynet.error("Results:", result1, result2)
    
    -- 4. åœæ­¢æœåŠ¡
    skynet.send(worker1, "lua", "stop")
    skynet.send(worker2, "lua", "stop")
end)
```

**æœ€ä½³å®è·µæ€»ç»“ï¼š**

1. **æœåŠ¡å‘½åè§„èŒƒï¼š**
   - æ™®é€šæœåŠ¡ï¼šä½¿ç”¨æè¿°æ€§åç§°ï¼Œå¦‚ "player_agent", "task_worker"
   - å”¯ä¸€æœåŠ¡ï¼šä½¿ç”¨ç®¡ç†å™¨å‘½åï¼Œå¦‚ "db_manager", "config_manager"

2. **å‚æ•°ä¼ é€’ï¼š**
   - ä½¿ç”¨ç®€å•æ•°æ®ç±»å‹ï¼ˆstring, number, booleanï¼‰
   - å¤æ‚æ•°æ®ä½¿ç”¨tableï¼Œä½†è¦æ³¨æ„åºåˆ—åŒ–å¼€é”€

3. **æœåŠ¡ç”Ÿå‘½å‘¨æœŸï¼š**
   - åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„æœåŠ¡ä»¥èŠ‚çœèµ„æº
   - ä¼˜é›…åœæ­¢è€Œä¸æ˜¯å¼ºåˆ¶kill

---

## æ¶ˆæ¯ä¼ é€’

### skynet.send(address, typename, ...)
å‘é€æ¶ˆæ¯ï¼ˆä¸ç­‰å¾…å›å¤ï¼‰ã€‚

```lua
skynet.send(service_id, "lua", "command", param1, param2)
```

### skynet.call(address, typename, ...)
å‘é€æ¶ˆæ¯å¹¶ç­‰å¾…å›å¤ã€‚

```lua
local result = skynet.call(service_id, "lua", "query", query_data)
```

### skynet.ret(msg, sz)
å›å¤æ¶ˆæ¯ã€‚

```lua
skynet.ret(skynet.pack("success", data))
```

### skynet.response()
è·å–å›å¤å‡½æ•°ã€‚

```lua
local response = skynet.response()
-- å¼‚æ­¥å¤„ç†åå›å¤
response(true, result)
```

### skynet.dispatch(typename, func)
æ³¨å†Œæ¶ˆæ¯å¤„ç†å‡½æ•°ã€‚

```lua
skynet.dispatch("lua", function(session, address, cmd, ...)
    if cmd == "ping" then
        skynet.ret(skynet.pack("pong"))
    end
end)
```

### skynet.register_protocol(protocol)
æ³¨å†Œè‡ªå®šä¹‰åè®®ã€‚

```lua
skynet.register_protocol {
    name = "custom",
    id = skynet.PTYPE_TEXT,
    pack = function(...) return ... end,
    unpack = skynet.tostring,
}
```

---

## å®šæ—¶å™¨

### skynet.timeout(time, func)
è®¾ç½®å•æ¬¡å®šæ—¶å™¨ã€‚

```lua
skynet.timeout(100, function()  -- 100å˜ç§’åæ‰§è¡Œ
    skynet.error("Timer fired")
end)
```

### skynet.sleep(time)
æš‚åœå½“å‰åç¨‹ã€‚

```lua
skynet.sleep(100)  -- æš‚åœ100å˜ç§’
```

### skynet.now()
è·å–å½“å‰æ—¶é—´ï¼ˆå˜ç§’ï¼‰ã€‚

```lua
local current_time = skynet.now()
```

### skynet.time()
è·å–å½“å‰Unixæ—¶é—´æˆ³ã€‚

```lua
local timestamp = skynet.time()
```

### skynet.starttime()
è·å–ç³»ç»Ÿå¯åŠ¨æ—¶é—´ã€‚

```lua
local start_time = skynet.starttime()
```

---

## æ•°æ®åº“æ“ä½œ

### MySQL

```lua
local mysql = require "skynet.db.mysql"

-- è¿æ¥æ•°æ®åº“
local db = mysql.connect({
    host = "127.0.0.1",
    port = 3306,
    database = "test",
    user = "root",
    password = "password",
    max_packet_size = 1024 * 1024,
    on_connect = function(db)
        db:query("set charset utf8")
    end
})

-- æ‰§è¡ŒæŸ¥è¯¢
local result = db:query("SELECT * FROM users WHERE id = ?", user_id)

-- æ–­å¼€è¿æ¥
db:disconnect()
```

### Redis

```lua
local redis = require "skynet.db.redis"

-- è¿æ¥Redis
local db = redis.connect({
    host = "127.0.0.1",
    port = 6379,
    db = 0
})

-- æ‰§è¡Œå‘½ä»¤
local result = db:get("key")
db:set("key", "value")
db:hset("hash_key", "field", "value")

-- æ–­å¼€è¿æ¥
db:disconnect()
```

---

## ç½‘ç»œç›¸å…³

### Socket API

```lua
local socket = require "skynet.socket"

-- ç›‘å¬ç«¯å£
local listen_id = socket.listen("0.0.0.0", 8001)
socket.start(listen_id, function(id, addr)
    socket.start(id)
    while true do
        local data = socket.read(id)
        if data then
            socket.write(id, "echo: " .. data)
        else
            break
        end
    end
    socket.close(id)
end)

-- è¿æ¥è¿œç¨‹æœåŠ¡å™¨
local id = socket.open("127.0.0.1", 8080)
socket.write(id, "Hello Server")
local response = socket.read(id)
socket.close(id)
```

### HTTPæœåŠ¡

```lua
local httpd = require "http.httpd"
local sockethelper = require "http.sockethelper"
local urllib = require "http.url"

local function response(id, write, ...)
    local ok, err = httpd.write_response(write, 200, "Hello World")
    if not ok then
        skynet.error(string.format("fd = %d, %s", id, err))
    end
end

skynet.start(function()
    local agent = {}
    local protocol = "http"
    local port = 8001
    
    local listen_socket = sockethelper.listen("0.0.0.0", port)
    
    socket.start(listen_socket , function(id, addr)
        socket.start(id)
        pcall(httpd.read_request, sockethelper.readfunc(id), response, id)
        socket.close(id)
    end)
    
    skynet.error("HTTP Server start on port " .. port)
end)
```

---

## é›†ç¾¤ç®¡ç†

### cluster API

```lua
local cluster = require "skynet.cluster"

-- æ‰“å¼€é›†ç¾¤èŠ‚ç‚¹
cluster.open("node1")

-- è°ƒç”¨è¿œç¨‹æœåŠ¡
local result = cluster.call("node1", "service_name", "method", params)

-- å‘é€æ¶ˆæ¯åˆ°è¿œç¨‹æœåŠ¡
cluster.send("node1", "service_name", "method", params)

-- æŸ¥è¯¢è¿œç¨‹æœåŠ¡
local proxy = cluster.query("node1", "service_name")
```

### é›†ç¾¤é…ç½®

```lua
-- cluster.lua é…ç½®æ–‡ä»¶
return {
    node1 = "127.0.0.1:7001",
    node2 = "127.0.0.1:7002",
    node3 = "127.0.0.1:7003",
}
```

---

## é…ç½®ç®¡ç†

### skynet.getenv(key)
è·å–é…ç½®é¡¹ã€‚

```lua
local thread_count = tonumber(skynet.getenv("thread")) or 8
local daemon_file = skynet.getenv("daemon")
```

### å¸¸ç”¨é…ç½®é¡¹

```
thread = 8                  -- å·¥ä½œçº¿ç¨‹æ•°
harbor = 0                  -- é›†ç¾¤èŠ‚ç‚¹ID
start = "main"              -- å¯åŠ¨æœåŠ¡
bootstrap = "snlua bootstrap"  -- å¼•å¯¼æœåŠ¡
daemon = "./skynet.pid"     -- å®ˆæŠ¤è¿›ç¨‹PIDæ–‡ä»¶
logger = nil                -- æ—¥å¿—æœåŠ¡
logservice = "logger"       -- æ—¥å¿—æœåŠ¡å
logpath = "."              -- æ—¥å¿—è·¯å¾„
```

---

## è°ƒè¯•å·¥å…·

### skynet.trace()
å¼€å¯/å…³é—­æ¶ˆæ¯è·Ÿè¸ªã€‚

```lua
skynet.trace()  -- å¼€å¯è·Ÿè¸ª
```

### debug console

```lua
local console = require "skynet.debug"

-- å¯åŠ¨è°ƒè¯•æ§åˆ¶å°
console.start()
```

### å†…å­˜ç»Ÿè®¡

```lua
local memory = require "skynet.memory"

-- è·å–å†…å­˜ä½¿ç”¨æƒ…å†µ
local info = memory.info()
skynet.error("Memory usage: " .. info.total)
```

### æ€§èƒ½åˆ†æ

```lua
local profile = require "skynet.profile"

-- å¼€å§‹æ€§èƒ½åˆ†æ
profile.start()

-- æ‰§è¡Œéœ€è¦åˆ†æçš„ä»£ç 
-- ...

-- åœæ­¢åˆ†æå¹¶è·å–ç»“æœ
local result = profile.stop()
```

---

## å®ç”¨å·¥å…·

### JSONå¤„ç†

```lua
local json = require "json"

-- ç¼–ç 
local json_str = json.encode({name = "test", value = 123})

-- è§£ç 
local data = json.decode(json_str)
```

### å­—ç¬¦ä¸²å¤„ç†

```lua
local string = require "string"

-- åˆ†å‰²å­—ç¬¦ä¸²
local function split(str, delimiter)
    local result = {}
    local pattern = "[^" .. delimiter .. "]+"
    for match in string.gmatch(str, pattern) do
        table.insert(result, match)
    end
    return result
end
```

### è¡¨æ“ä½œ

```lua
-- æ·±æ‹·è´è¡¨
local function deepcopy(orig)
    local orig_type = type(orig)
    local copy
    if orig_type == 'table' then
        copy = {}
        for orig_key, orig_value in next, orig, nil do
            copy[deepcopy(orig_key)] = deepcopy(orig_value)
        end
        setmetatable(copy, deepcopy(getmetatable(orig)))
    else
        copy = orig
    end
    return copy
end
```

---

## æœ€ä½³å®è·µ

### 1. æœåŠ¡è®¾è®¡åŸåˆ™
- ä¿æŒæœåŠ¡è½»é‡çº§
- é¿å…é˜»å¡æ“ä½œ
- åˆç†ä½¿ç”¨æ¶ˆæ¯ä¼ é€’
- æ­£ç¡®å¤„ç†é”™è¯¯æƒ…å†µ

### 2. æ€§èƒ½ä¼˜åŒ–
- å‡å°‘ä¸å¿…è¦çš„æ¶ˆæ¯ä¼ é€’
- åˆç†ä½¿ç”¨ç¼“å­˜
- é¿å…é¢‘ç¹çš„å­—ç¬¦ä¸²æ‹¼æ¥
- ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨å¯¹è±¡

### 3. é”™è¯¯å¤„ç†
```lua
local function safe_call(func, ...)
    local ok, result = pcall(func, ...)
    if not ok then
        skynet.error("Error: " .. tostring(result))
        return nil
    end
    return result
end
```

### 4. çƒ­æ›´æ–°
```lua
-- çƒ­æ›´æ–°æœåŠ¡ä»£ç 
skynet.send(".launcher", "lua", "RELOAD", service_name)
```

---

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†æœåŠ¡é—´çš„å¾ªç¯ä¾èµ–ï¼Ÿ
A: ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œé¿å…ç›´æ¥çš„å‡½æ•°è°ƒç”¨ä¾èµ–ã€‚

### Q: å¦‚ä½•ç¡®ä¿æ¶ˆæ¯çš„å¯é ä¼ é€’ï¼Ÿ
A: ä½¿ç”¨ skynet.call è€Œä¸æ˜¯ skynet.sendï¼Œå¹¶æ·»åŠ é€‚å½“çš„é”™è¯¯å¤„ç†ã€‚

### Q: å¦‚ä½•ç›‘æ§æœåŠ¡çŠ¶æ€ï¼Ÿ
A: ä½¿ç”¨ debug console æˆ–è‡ªå®šä¹‰ç›‘æ§æœåŠ¡ã€‚

---

## å‚è€ƒèµ„æº

- [Skynet GitHubä»“åº“](https://github.com/cloudwu/skynet)
- [å®˜æ–¹Wiki](https://github.com/cloudwu/skynet/wiki)
- [äº‘é£åšå®¢](https://blog.codingnow.com/)

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*  
*æ›´æ–°æ—¥æœŸï¼š2025å¹´8æœˆ19æ—¥*
